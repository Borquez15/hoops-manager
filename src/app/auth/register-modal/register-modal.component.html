<div class="overlay" *ngIf="open" (click)="close.emit()"></div>

<div class="modal" *ngIf="open" role="dialog" aria-modal="true"
     (click)="$event.stopPropagation()">
  <div class="panel">
    <header class="head">
      <h2>Crear cuenta</h2>
      <button class="close" (click)="close.emit()" aria-label="Cerrar">√ó</button>
    </header>

    <div class="body">
      <!-- ‚úÖ MENSAJE DE √âXITO -->
      <div *ngIf="successMsg" class="success-alert">
        <div class="success-icon">‚úì</div>
        <div class="success-content">
          <h3>¬°Registro Exitoso!</h3>
          <p>{{ successMsg }}</p>
          <small>Redirigiendo al login...</small>
        </div>
      </div>

      <!-- FORMULARIO (ocultar si hay mensaje de √©xito) -->
      <form *ngIf="!successMsg" class="form" [formGroup]="form" (ngSubmit)="submit()">
        <div class="row">
          <label>
            Nombre(s)
            <input type="text" formControlName="nombre" placeholder="Juan">
            <small class="hint error" *ngIf="form.get('nombre')?.touched && form.get('nombre')?.invalid">
              M√≠nimo 2 caracteres
            </small>
          </label>

          <label>
            Apellido paterno
            <input type="text" formControlName="ap_p" placeholder="P√©rez">
            <small class="hint error" *ngIf="form.get('ap_p')?.touched && form.get('ap_p')?.invalid">
              Requerido
            </small>
          </label>
        </div>

        <label>
          Apellido materno (opcional)
          <input type="text" formControlName="ap_m" placeholder="Garc√≠a">
        </label>

        <label>
          Correo electr√≥nico
          <input type="email" formControlName="email" placeholder="tucorreo@dominio.com">
          <small class="hint error" *ngIf="form.get('email')?.touched && form.get('email')?.invalid">
            Ingresa un correo v√°lido
          </small>
        </label>

        <label>
          Contrase√±a
          <div class="pwd">
            <input [type]="hide ? 'password':'text'" formControlName="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button type="button" class="eye" (click)="hide=!hide" aria-label="Mostrar/ocultar">üëÅ</button>
          </div>
          <small class="hint error" *ngIf="form.get('password')?.touched && form.get('password')?.invalid">
            M√≠nimo 6 caracteres
          </small>
        </label>

        <label>
          Confirmar contrase√±a
          <input [type]="hide ? 'password':'text'" formControlName="confirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </label>

        <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>

        <button class="btn btn-primary wfull" type="submit" [disabled]="loading || form.invalid">
          <span *ngIf="!loading">Registrarse</span>
          <span *ngIf="loading">Creando cuenta...</span>
        </button>
      </form>

      <div class="or" *ngIf="!successMsg"><span>o</span></div>

      <button class="btn btn-google wfull" type="button" (click)="loginWithGoogle()" 
              [disabled]="loading || !!successMsg" *ngIf="!successMsg">
        <span class="g">G</span> Registrarse con Google
      </button>

      <button type="button" class="link" (click)="goLogin.emit()" [disabled]="loading">
        ¬øYa tienes cuenta? Inicia sesi√≥n
      </button>
    </div>
  </div>
</div>