<div class="overlay" *ngIf="open" (click)="close.emit()"></div>

<div class="modal" *ngIf="open" role="dialog" aria-modal="true" aria-labelledby="forgotTitle"
     (click)="$event.stopPropagation()">
  <div class="panel">
    <header class="head">
      <h2 id="forgotTitle">Recuperar contraseña</h2>
      <button class="close" (click)="close.emit()" aria-label="Cerrar">×</button>
    </header>

    <div class="body">
      <!-- Formulario (visible hasta que se envíe) -->
      <div *ngIf="!success">
        <p class="description">
          Ingresa tu correo electrónico y te enviaremos las instrucciones para restablecer tu contraseña.
        </p>
        
        <form class="form" [formGroup]="form" (ngSubmit)="submit()">
          <label>
            Correo electrónico
            <input 
              type="email" 
              formControlName="email" 
              placeholder="tucorreo@dominio.com"
              autofocus>
            <small class="hint error" *ngIf="form.get('email')?.touched && form.get('email')?.invalid">
              Ingresa un correo válido.
            </small>
          </label>

          <button 
            class="btn btn-primary wfull" 
            type="submit" 
            [disabled]="loading || form.invalid">
            <span *ngIf="!loading">Enviar instrucciones</span>
            <span *ngIf="loading">Enviando...</span>
          </button>
        </form>

        <button 
          type="button" 
          class="link" 
          (click)="goBack.emit()" 
          [disabled]="loading">
          Volver al login
        </button>
      </div>

      <!-- Mensaje de éxito -->
      <div *ngIf="success" class="success-message">
        <div class="success-icon">✓</div>
        <h3>¡Email enviado!</h3>
        <p>
          Si el correo existe en nuestro sistema, recibirás las instrucciones para restablecer tu contraseña.
        </p>
        <p class="hint-text">
          Revisa tu bandeja de entrada y la carpeta de spam.
        </p>
        <button class="btn btn-secondary wfull" (click)="goBack.emit()">
          Volver al login
        </button>
      </div>

      <!-- Mensaje de error -->
      <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>
    </div>
  </div>
</div>