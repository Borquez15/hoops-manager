<!-- pages/accept-referee-invite/accept-referee-invite.component.html -->
<div class="container">
  <!-- LOADING -->
  <div *ngIf="loading" class="card">
    <div class="loading-state">
      <div class="spinner"></div>
      <h2>Verificando invitaci√≥n...</h2>
      <p>Por favor espera un momento</p>
    </div>
  </div>

  <!-- LOGIN REQUERIDO -->
  <div *ngIf="estadoVista === 'login-requerido'" class="card">
    <div class="icon-large">üîê</div>
    <h1>Inicio de Sesi√≥n Requerido</h1>
    
    <div class="info-box">
      <p><strong>Invitaci√≥n para:</strong> {{ invitacion?.email }}</p>
      <p><strong>Torneo:</strong> {{ invitacion?.torneo }}</p>
      <p><strong>Expira:</strong> {{ formatearFecha(invitacion?.expira_en || '') }}</p>
    </div>

    <p class="message">
      Para aceptar esta invitaci√≥n, debes iniciar sesi√≥n con la cuenta asociada al email
      <strong>{{ invitacion?.email }}</strong>
    </p>

    <div class="actions">
      <button class="btn btn-primary" (click)="irALogin()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/>
        </svg>
        Iniciar Sesi√≥n
      </button>
      
      <button class="btn btn-secondary" (click)="irARegistro()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
        </svg>
        Crear Cuenta
      </button>
    </div>
  </div>

  <!-- EMAIL DIFERENTE -->
  <div *ngIf="estadoVista === 'email-diferente'" class="card">
    <div class="icon-large error">‚ö†Ô∏è</div>
    <h1>Email No Coincide</h1>
    
    <div class="info-box warning">
      <p><strong>Invitaci√≥n enviada a:</strong> {{ invitacion?.email }}</p>
      <p><strong>Email actual:</strong> {{ currentUserEmail }}</p>
    </div>

    <p class="message">
      Esta invitaci√≥n es para el email <strong>{{ invitacion?.email }}</strong>,
      pero has iniciado sesi√≥n con <strong>{{ currentUserEmail }}</strong>
    </p>

    <div class="actions">
      <button class="btn btn-primary" (click)="auth.logout(); irALogin()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
        </svg>
        Cerrar Sesi√≥n e Iniciar con Otro Email
      </button>
      
      <button class="btn btn-secondary" routerLink="/">
        Cancelar
      </button>
    </div>
  </div>

  <!-- PUEDE ACEPTAR -->
  <div *ngIf="estadoVista === 'puede-aceptar'" class="card">
    <div class="icon-large">üèÄ</div>
    <h1>Invitaci√≥n de √Årbitro</h1>
    
    <div class="info-box">
      <p><strong>Torneo:</strong> {{ invitacion?.torneo }}</p>
      <p><strong>Email:</strong> {{ invitacion?.email }}</p>
      <p><strong>Expira:</strong> {{ formatearFecha(invitacion?.expira_en || '') }}</p>
    </div>

    <p class="message">
      Has sido invitado para ser √°rbitro de este torneo.
      ¬øDeseas aceptar la invitaci√≥n?
    </p>

    <div class="actions">
      <button 
        class="btn btn-success" 
        (click)="aceptarInvitacion()"
        [disabled]="procesando">
        <span *ngIf="!procesando">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
          </svg>
          Aceptar Invitaci√≥n
        </span>
        <span *ngIf="procesando" class="loading-text">
          <div class="spinner-small"></div>
          Procesando...
        </span>
      </button>
      
      <button 
        class="btn btn-danger" 
        (click)="rechazarInvitacion()"
        [disabled]="procesando">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
        Rechazar
      </button>
    </div>
  </div>

  <!-- √âXITO -->
  <div *ngIf="estadoVista === 'exito'" class="card">
    <div class="icon-large success">‚úì</div>
    <h1>¬°Invitaci√≥n Aceptada!</h1>
    
    <p class="message success">
      {{ mensaje }}
    </p>

    <p class="submessage">
      Ser√°s redirigido al panel de √°rbitro en unos segundos...
    </p>

    <div class="loading-dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <!-- YA PROCESADA -->
  <div *ngIf="estadoVista === 'ya-procesada'" class="card">
    <div class="icon-large">‚ÑπÔ∏è</div>
    <h1>Invitaci√≥n No Disponible</h1>
    
    <p class="message">
      {{ mensaje }}
    </p>

    <div class="actions">
      <button class="btn btn-primary" routerLink="/">
        Volver al Inicio
      </button>
    </div>
  </div>

  <!-- ERROR -->
  <div *ngIf="estadoVista === 'error'" class="card">
    <div class="icon-large error">‚ùå</div>
    <h1>Error</h1>
    
    <p class="message error">
      {{ error }}
    </p>

    <div class="actions">
      <button class="btn btn-primary" routerLink="/">
        Volver al Inicio
      </button>
    </div>
  </div>
</div>