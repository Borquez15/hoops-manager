<div class="crear-torneo-container">
  <!-- HEADER -->
  <header class="header">
    <div class="header__content">
      <button class="btn-volver" (click)="volver()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
        Volver
      </button>
      <h1 class="page-title">CREAR TORNEO</h1>
    </div>
  </header>

  <main class="content">
    <!-- ALERTAS -->
    <div class="alert alert-error" *ngIf="error">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
      </svg>
      {{ error }}
      <button class="btn-close-alert" (click)="error = null">‚úï</button>
    </div>

    <div class="alert alert-success" *ngIf="torneoCreado">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      ¬°Torneo creado exitosamente! Redirigiendo...
    </div>

    <div class="grid">
      <!-- CONFIGURACI√ìN (Compacta) -->
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">Configuracion</h2>
          <button class="btn-icon btn-edit" (click)="abrirModalConfig()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
          </button>
        </div>

        <div class="card-body">
          <div class="config-resumen">
            <div class="config-item">
              <span class="config-label">Nombre:</span>
              <span class="config-value">{{ config.nombre || 'Sin nombre' }}</span>
            </div>
            <div class="config-item">
              <span class="config-label">Modalidad:</span>
              <span class="config-value">{{ config.modalidad }}</span>
            </div>
            <div class="config-item">
              <span class="config-label">Vueltas:</span>
              <span class="config-value">{{ config.vueltas }}</span>
            </div>
            <div class="config-item">
              <span class="config-label">Playoffs:</span>
              <span class="config-value">{{ config.cupos_playoffs }} equipos</span>
            </div>
            <div class="config-item">
              <span class="config-label">Horario:</span>
              <span class="config-value">{{ config.hora_ini }} - {{ config.hora_fin }}</span>
            </div>
          </div>
        </div>
      </section>

      <!-- √ÅRBITROS -->
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">Arbitros</h2>
          <button class="btn-icon btn-add" (click)="agregarArbitro()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
          </button>
        </div>

        <div class="card-body">
          <div class="list">
            <div class="list-item" *ngFor="let arbitro of arbitros; let i = index">
              <svg class="list-item-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
              <span class="list-item-text">{{ arbitro.nombre }}</span>
              <button class="btn-icon-small btn-delete" (click)="eliminarArbitro(i)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>

            <div class="empty-state" *ngIf="arbitros.length === 0">
              <p>No hay √°rbitros agregados</p>
            </div>
          </div>
        </div>
      </section>

      <!-- EQUIPOS -->
      <section class="card card-wide">
        <div class="card-header">
          <h2 class="card-title">Equipos</h2>
          <button class="btn-icon btn-add" (click)="abrirModalEquipo()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
          </button>
        </div>

        <div class="card-body">
          <div class="list">
            <div class="list-item" *ngFor="let equipo of equipos; let i = index">
              <div class="equipo-logo">
                {{ equipo.nombre.charAt(0) }}
              </div>
              <span class="list-item-text">{{ equipo.nombre }}</span>
              <div class="list-item-actions">
                <button class="btn-icon-small" (click)="editarEquipo(i)">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                  </svg>
                </button>
                <button class="btn-icon-small btn-delete" (click)="eliminarEquipo(i)">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                  </svg>
                </button>
              </div>
            </div>

            <div class="empty-state" *ngIf="equipos.length === 0">
              <p>No hay equipos agregados</p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- BOT√ìN CREAR TORNEO -->
    <div class="footer-actions">
      <button 
        class="btn btn-primary btn-large" 
        (click)="crearTorneo()"
        [disabled]="!esConfigValida || loading"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" *ngIf="!loading">
          <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
        </svg>
        <span *ngIf="loading">Creando...</span>
        <span *ngIf="!loading">üèÜ CREAR TORNEO</span>
      </button>
    </div>
  </main>
</div>

<!-- ========================================
     MODAL DE CONFIGURACI√ìN EXPANDIDA
     ======================================== -->
<div class="modal-overlay" *ngIf="modalConfigAbierto" (click)="cerrarModalConfig()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Configuraci√≥n del Torneo</h2>
      <button class="btn-close" (click)="cerrarModalConfig()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Nombre del torneo -->
      <div class="form-group">
        <label>Nombre del torneo *</label>
        <input 
          type="text" 
          class="form-control" 
          [(ngModel)]="config.nombre" 
          placeholder="Ej: Liga Primavera 2024"
        />
      </div>

      <!-- Vueltas y Playoffs -->
      <div class="form-row">
        <div class="form-group">
          <label>Vueltas a jugar</label>
          <div class="counter">
            <button class="btn-counter" (click)="decrementar('vueltas')">‚àí</button>
            <span class="counter-value">{{ config.vueltas }}</span>
            <button class="btn-counter" (click)="incrementar('vueltas')">+</button>
          </div>
        </div>

        <div class="form-group">
          <label>Clasificaci√≥n de playoffs</label>
          <div class="counter">
            <button class="btn-counter" (click)="decrementar('cupos_playoffs')">‚àí</button>
            <span class="counter-value">{{ config.cupos_playoffs }}</span>
            <button class="btn-counter" (click)="incrementar('cupos_playoffs')">+</button>
          </div>
        </div>
      </div>

      <!-- Modalidad -->
      <div class="form-group">
        <label>Modalidad de juego</label>
        <div class="toggle-group">
          <button 
            class="toggle-btn" 
            [class.active]="config.modalidad === '3v3'"
            (click)="cambiarModalidad('3v3')"
          >
            3 vs 3
          </button>
          <button 
            class="toggle-btn" 
            [class.active]="config.modalidad === '5v5'"
            (click)="cambiarModalidad('5v5')"
          >
            5 vs 5
          </button>
        </div>
      </div>

      <!-- D√≠as y partidos -->
      <div class="form-row">
        <div class="form-group">
          <label>D√≠as por semana</label>
          <div class="counter">
            <button class="btn-counter" (click)="decrementar('dias_por_semana')">‚àí</button>
            <span class="counter-value">{{ config.dias_por_semana }}</span>
            <button class="btn-counter" (click)="incrementar('dias_por_semana')">+</button>
          </div>
        </div>

        <div class="form-group">
          <label>Partidos por d√≠a</label>
          <div class="counter">
            <button class="btn-counter" (click)="decrementar('partidos_por_dia')">‚àí</button>
            <span class="counter-value">{{ config.partidos_por_dia }}</span>
            <button class="btn-counter" (click)="incrementar('partidos_por_dia')">+</button>
          </div>
        </div>
      </div>

      <!-- Horarios -->
      <div class="form-row">
        <div class="form-group">
          <label>Hora de inicio</label>
          <input 
            type="time" 
            class="form-control" 
            [(ngModel)]="config.hora_ini"
          />
        </div>

        <div class="form-group">
          <label>Hora de fin</label>
          <input 
            type="time" 
            class="form-control" 
            [(ngModel)]="config.hora_fin"
          />
        </div>
      </div>

      <!-- Duraci√≥n de partidos -->
      <div class="form-group">
        <label>Duraci√≥n de partido (minutos)</label>
        <div class="counter">
          <button class="btn-counter" (click)="decrementarSlotMin()">‚àí</button>
          <span class="counter-value">{{ config.slot_min }} min</span>
          <button class="btn-counter" (click)="incrementarSlotMin()">+</button>
        </div>
      </div>

      <!-- Secci√≥n de Canchas -->
      <div class="canchas-section">
        <h3 class="section-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
          </svg>
          Canchas del Torneo
        </h3>

        <!-- Lista de canchas -->
        <div class="canchas-list">
          <div class="cancha-item" *ngFor="let cancha of canchas; let i = index">
            <div class="cancha-info">
              <div class="cancha-nombre">
                {{ cancha.nombre }}
                <span class="cancha-badge" [class.activa]="cancha.activa">
                  {{ cancha.activa ? 'Activa' : 'Inactiva' }}
                </span>
              </div>
              <div class="cancha-ubicacion">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
                </svg>
                {{ cancha.ubicacion || 'Sin ubicaci√≥n' }}
              </div>
            </div>
            <div class="cancha-actions">
              <button 
                class="btn-icon-small" 
                (click)="toggleEstadoCancha(i)"
                [class.active]="cancha.activa"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
              </button>
              <button class="btn-icon-small" (click)="editarCancha(i)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/>
                </svg>
              </button>
              <button class="btn-icon-small btn-delete" (click)="eliminarCancha(i)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="empty-state" *ngIf="canchas.length === 0">
            <p>No hay canchas agregadas</p>
          </div>
        </div>

        <!-- Formulario para agregar cancha -->
        <div class="nueva-cancha-form">
          <input 
            type="text" 
            class="form-control form-control-sm" 
            [(ngModel)]="nombreCanchaActual" 
            placeholder="Nombre de la cancha"
          />
          <input 
            type="text" 
            class="form-control form-control-sm" 
            [(ngModel)]="ubicacionCanchaActual" 
            placeholder="Ubicaci√≥n"
          />
          <button 
            class="btn btn-secondary btn-sm" 
            (click)="editandoCancha ? guardarEdicionCancha() : agregarCancha()"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            {{ editandoCancha ? 'Guardar' : 'Agregar' }}
          </button>
          <button 
            *ngIf="editandoCancha"
            class="btn btn-secondary btn-sm" 
            (click)="cancelarEdicionCancha()"
          >
            Cancelar
          </button>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalConfig()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="guardarConfiguracion()">
        Guardar Configuraci√≥n
      </button>
    </div>
  </div>
</div>

<!-- ========================================
     MODAL DE EQUIPOS CON JUGADORES
     ======================================== -->
<div class="modal-overlay" *ngIf="modalEquipoAbierto" (click)="cerrarModalEquipo()">
  <div class="modal modal-equipo" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ indiceEquipoEditando === -1 ? 'Agregar Equipo' : 'Editar Equipo' }}</h2>
      <button class="btn-close" (click)="cerrarModalEquipo()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Alerta de error -->
      <div class="alert alert-error" *ngIf="error">
        {{ error }}
        <button class="btn-close-alert" (click)="error = null">‚úï</button>
      </div>

      <!-- Informaci√≥n del equipo -->
      <div class="equipo-info-section">
        <div class="equipo-logo-grande">
          <div class="equipo-logo-placeholder">
            {{ (equipoEditando?.nombre || '?').charAt(0).toUpperCase() }}
          </div>
        </div>
        
        <div class="form-group">
          <label>Nombre del Equipo *</label>
          <input 
            type="text" 
            class="form-control form-control-lg" 
            [(ngModel)]="equipoEditando!.nombre"
            placeholder="Ej: Dallas Mavericks"
          />
        </div>
      </div>

      <!-- Secci√≥n de Jugadores -->
      <div class="jugadores-modal-section">
        <h3 class="section-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
          </svg>
          Jugadores ({{ (equipoEditando?.jugadores?.length || 0) }})
        </h3>

        <!-- Lista de jugadores -->
        <div class="jugadores-lista-modal" *ngIf="equipoEditando && equipoEditando.jugadores.length > 0">
          <div 
            class="jugador-item-modal" 
            *ngFor="let jugador of jugadoresOrdenados; let i = index"
            [class.inactive]="!jugador.activo"
          >
            <div class="jugador-dorsal">#{{ jugador.dorsal < 10 ? '0' : '' }}{{ jugador.dorsal }}</div>
            <div class="jugador-info">
              <div class="jugador-nombre">{{ nombreCompletoJugador(jugador) }}</div>
              <div class="jugador-curp">CURP: {{ jugador.curp }}</div>
            </div>
            <div class="jugador-actions">
              <button 
                class="btn-icon-small"
                [class.active]="jugador.activo"
                (click)="toggleJugadorActivo(i)"
                [title]="jugador.activo ? 'Desactivar' : 'Activar'"
              >
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
              </button>
              <button 
                class="btn-icon-small btn-delete"
                (click)="eliminarJugadorDelEquipo(i)"
                title="Eliminar"
              >
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="empty-state-small" *ngIf="!equipoEditando || equipoEditando.jugadores.length === 0">
          <p>No hay jugadores en este equipo</p>
        </div>

        <!-- Formulario para agregar jugador -->
        <div class="agregar-jugador-modal-form">
          <h4>Agregar Jugador</h4>

          <!-- CURP y Dorsal -->
          <div class="form-row">
            <div class="form-group form-group-curp">
              <label>CURP *</label>
              <div class="input-with-button">
                <input 
                  type="text" 
                  class="form-control" 
                  [(ngModel)]="nuevoJugador.curp"
                  placeholder="18 caracteres"
                  maxlength="18"
                  (input)="nuevoJugador.curp = nuevoJugador.curp.toUpperCase()"
                />
                <button 
                  class="btn btn-secondary btn-sm"
                  (click)="buscarPorCURP()"
                  [disabled]="buscandoCURP || nuevoJugador.curp.length !== 18"
                >
                  <span *ngIf="!buscandoCURP">üîç</span>
                  <span *ngIf="buscandoCURP">...</span>
                </button>
              </div>
              <small class="form-hint" *ngIf="jugadorEncontrado">
                ‚úì Jugador encontrado en el sistema
              </small>
            </div>

            <div class="form-group">
              <label>Dorsal *</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="nuevoJugador.dorsal"
                min="0"
                max="99"
              />
            </div>
          </div>

          <!-- Nombres y Apellidos -->
          <div class="form-row">
            <div class="form-group">
              <label>Nombres *</label>
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="nuevoJugador.nombres"
                placeholder="Nombres"
                [disabled]="!!jugadorEncontrado"
              />
            </div>

            <div class="form-group">
              <label>Apellido Paterno *</label>
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="nuevoJugador.ap_p"
                placeholder="Apellido paterno"
                [disabled]="!!jugadorEncontrado"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Apellido Materno</label>
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="nuevoJugador.ap_m"
                placeholder="Apellido materno (opcional)"
                [disabled]="!!jugadorEncontrado"
              />
            </div>

            <div class="form-group">
              <label>Edad</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="nuevoJugador.edad"
                placeholder="Edad"
                min="5"
                max="99"
                [disabled]="!!jugadorEncontrado"
              />
            </div>
          </div>

          <!-- Bot√≥n agregar jugador -->
          <button 
            class="btn btn-secondary btn-block"
            (click)="agregarJugadorAlEquipo()"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            Agregar Jugador
          </button>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalEquipo()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="guardarEquipo()">
        {{ indiceEquipoEditando === -1 ? 'Crear Equipo' : 'Guardar Cambios' }}
      </button>
    </div>
  </div>
</div>