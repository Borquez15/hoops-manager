<section class="screen">
  <div class="card-navy">
    <div class="header">
      <button class="back" type="button" (click)="volver()">‚Üê Volver</button>
      <h2 *ngIf="torneo; else titulo">{{ torneo.nombre }}</h2>
      <ng-template #titulo><h2>Detalle del torneo</h2></ng-template>
    </div>

    <!-- Estados de carga / error -->
    <div *ngIf="loading" class="state">Cargando...</div>
    <div *ngIf="!loading && error" class="state err">{{ error }}</div>

    <!-- Info principal del torneo -->
    <div *ngIf="!loading && torneo" class="info-grid">
      <div class="info">
        <div class="label">Modalidad</div>
        <div class="value">{{ torneo.modalidad }}</div>
      </div>
      <div class="info">
        <div class="label">Vueltas</div>
        <div class="value">{{ torneo.vueltas }}</div>
      </div>
      <div class="info">
        <div class="label">Cupos Playoffs</div>
        <div class="value">{{ torneo.cupos_playoffs }}</div>
      </div>
      <div class="info">
        <div class="label">Estado</div>
        <div class="value tag">{{ torneo.estado }}</div>
      </div>
    </div>

    <!-- Panels secundarios -->
    <div *ngIf="!loading && torneo" class="panels">
      
      <!-- TABLA GENERAL -->
      <div class="panel">
        <div class="panel-header">
          <h3>üìä Tabla general</h3>
          <button 
            *ngIf="standings.length > 0"
            class="btn-download" 
            (click)="downloadStandingsPDF()"
            [disabled]="downloadingPDF"
            title="Descargar tabla en PDF">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
            </svg>
            <span *ngIf="!downloadingPDF">PDF</span>
            <span *ngIf="downloadingPDF">...</span>
          </button>
        </div>
        
        <div *ngIf="loadingStandings" class="placeholder">Cargando tabla...</div>
        <div *ngIf="!loadingStandings && standings.length === 0" class="placeholder">
          No hay partidos jugados a√∫n.
        </div>
        <div *ngIf="!loadingStandings && standings.length > 0" class="table-container">
          <table class="standings-table">
            <thead>
              <tr>
                <th>Pos</th>
                <th>Equipo</th>
                <th>JJ</th>
                <th>JG</th>
                <th>JP</th>
                <th>PF</th>
                <th>PC</th>
                <th>DIF</th>
                <th>PTS</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of standings; let i = index">
                <td>{{ i + 1 }}</td>
                <td class="team-name">{{ row.equipo }}</td>
                <td>{{ row.jj }}</td>
                <td>{{ row.jg }}</td>
                <td>{{ row.jp }}</td>
                <td>{{ row.pf }}</td>
                <td>{{ row.pc }}</td>
                <td [class.positive]="row.dif > 0" [class.negative]="row.dif < 0">
                  {{ row.dif > 0 ? '+' : '' }}{{ row.dif }}
                </td>
                <td class="pts">{{ row.pts }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- CAMPEONES CANASTEROS -->
      <div class="panel">
        <div class="panel-header">
          <h3>üèÄ Campeones canasteros</h3>
          <button 
            *ngIf="scorers.length > 0"
            class="btn-download" 
            (click)="downloadScorersPDF()"
            [disabled]="downloadingPDF"
            title="Descargar anotadores en PDF">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
            </svg>
            <span *ngIf="!downloadingPDF">PDF</span>
            <span *ngIf="downloadingPDF">...</span>
          </button>
        </div>

        <div *ngIf="loadingScorers" class="placeholder">Cargando anotadores...</div>
        <div *ngIf="!loadingScorers && scorers.length === 0" class="placeholder">
          No hay estad√≠sticas disponibles.
        </div>
        <div *ngIf="!loadingScorers && scorers.length > 0" class="scorers-list">
          <div *ngFor="let scorer of scorers; let i = index" class="scorer-item">
            <span class="rank">{{ i + 1 }}.</span>
            <div class="scorer-info">
              <div class="scorer-name">{{ scorer.jugador }}</div>
              <div class="scorer-team">{{ scorer.equipo }}</div>
            </div>
            <div class="scorer-stats">
              <span class="pts-label">{{ scorer.pts }} pts</span>
              <span class="games-label">{{ scorer.jj }} JJ</span>
            </div>
          </div>
        </div>
      </div>

      <!-- PR√ìXIMOS JUEGOS CON FILTROS -->
      <div class="panel span-2">
        <div class="panel-header">
          <h3>üìÖ Calendario de partidos</h3>
          <button 
            class="btn-download" 
            (click)="downloadSchedulePDF()"
            [disabled]="downloadingPDF"
            title="Descargar calendario en PDF">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
            </svg>
            <span *ngIf="!downloadingPDF">PDF</span>
            <span *ngIf="downloadingPDF">...</span>
          </button>
        </div>

        <!-- ‚úÖ FILTROS CON BOTONES (ESTILO PR√ìXIMOS JUEGOS) -->
        <div class="filters-container">
          <div class="filter-row">
            <label class="filter-label">Per√≠odo:</label>
            <div class="filter-buttons">
              <button 
                class="filter-btn" 
                [class.active]="scheduleFilters.periodo === 'todos'"
                (click)="cambiarFiltroPeriodo('todos')"
              >
                Todos
              </button>
              <button 
                class="filter-btn" 
                [class.active]="scheduleFilters.periodo === 'semana'"
                (click)="cambiarFiltroPeriodo('semana')"
              >
                Esta Semana
              </button>
              <button 
                class="filter-btn" 
                [class.active]="scheduleFilters.periodo === 'mes'"
                (click)="cambiarFiltroPeriodo('mes')"
              >
                Este Mes
              </button>
            </div>
          </div>

          <div class="filter-row">
            <label class="filter-label">Estado:</label>
            <div class="filter-buttons">
              <button 
                class="filter-btn" 
                [class.active]="scheduleFilters.estado === 'todos'"
                (click)="cambiarFiltroEstado('todos')"
              >
                Todos
              </button>
              <button 
                class="filter-btn filter-programado" 
                [class.active]="scheduleFilters.estado === 'PROGRAMADO'"
                (click)="cambiarFiltroEstado('PROGRAMADO')"
              >
                Programados
              </button>
              <button 
                class="filter-btn filter-en-curso" 
                [class.active]="scheduleFilters.estado === 'JUGADO'"
                (click)="cambiarFiltroEstado('JUGADO')"
              >
                Jugados
              </button>
              <button 
                class="filter-btn filter-finalizado" 
                [class.active]="scheduleFilters.estado === 'FINALIZADO'"
                (click)="cambiarFiltroEstado('FINALIZADO')"
              >
                Finalizados
              </button>
            </div>
          </div>

          <div class="filter-info">
            <span class="resultados-info">Mostrando {{ filteredGames.length }} de {{ upcomingGames.length }} partidos</span>
          </div>
        </div>

        <div *ngIf="loadingGames" class="placeholder">Cargando partidos...</div>
        <div *ngIf="!loadingGames && filteredGames.length === 0" class="placeholder">
          No hay partidos que coincidan con los filtros.
        </div>
        
        <!-- Lista de partidos filtrados -->
        <div *ngIf="!loadingGames && filteredGames.length > 0" class="games-list">
          <div *ngFor="let game of filteredGames" class="game-card">
            <div class="game-date">
              <div class="date-day">{{ formatDate(game.fecha) }}</div>
              <div class="date-time">{{ game.hora || 'Por definir' }}</div>
            </div>
            <div class="game-teams">
              <div class="team team-local">
                <span class="team-badge">üè†</span>
                <span class="team-name">{{ game.equipo_local_nombre }}</span>
              </div>
              <div class="game-vs">VS</div>
              <div class="team team-visitor">
                <span class="team-name">{{ game.equipo_visitante_nombre }}</span>
                <span class="team-badge">‚úàÔ∏è</span>
              </div>
            </div>
            <div class="game-venue">
              <span class="venue-icon">üìç</span>
              <span>{{ game.cancha || 'Cancha principal' }}</span>
              <span class="game-status" [class]="'status-' + game.estado.toLowerCase()">
                {{ game.estado }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notificaci√≥n de descarga -->
    <div *ngIf="downloadMessage" class="download-notification">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      <span>{{ downloadMessage }}</span>
    </div>
  </div>
</section>