<div class="match-live-container">
  <!-- Loading -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando partido...</p>
  </div>

  <!-- Error -->
  <div class="error" *ngIf="error && !loading">
    <h2>‚ö†Ô∏è Error</h2>
    <p>{{ error }}</p>
    <button class="btn-back" (click)="goBack()">Volver</button>
  </div>

  <!-- SELECCI√ìN DE QUINTETO INICIAL -->
  <div class="quinteto-selector" *ngIf="seleccionandoQuinteto && !loading && partido">
    <div class="quinteto-header">
      <button class="btn-back-small" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
      </button>
      <h1>üìã SELECCIONAR QUINTETO INICIAL</h1>
    </div>

    <div class="quinteto-content">
      <div class="equipo-quinteto-card">
        <div class="equipo-header">
          <div class="equipo-logo-large">
            <img *ngIf="equipoSeleccionandoData?.logo_url" [src]="equipoSeleccionandoData?.logo_url">
            <span *ngIf="!equipoSeleccionandoData?.logo_url">
              {{ equipoSeleccionandoData?.nombre?.charAt(0) }}
            </span>
          </div>
          <h2>{{ equipoSeleccionandoData?.nombre }}</h2>
          <p class="subtitulo">Selecciona 5 jugadores iniciales</p>
        </div>

        <div class="contador-seleccion">
          <span class="seleccionados">{{ quintetoTemporal.length }}</span>
          <span class="separador">/</span>
          <span class="total">5</span>
          <small>jugadores seleccionados</small>
        </div>

        <div class="jugadores-grid">
          <div class="jugador-card"
               *ngFor="let jugador of equipoSeleccionandoData?.jugadores"
               [class.selected]="isJugadorSeleccionado(jugador)"
               (click)="toggleJugadorQuinteto(jugador)">
            <div class="jugador-numero-grande">{{ jugador.dorsal }}</div>
            <div class="jugador-info-completa">
              <h4>{{ jugador.ap_p }} {{ jugador.ap_m }}</h4>
              <p>{{ jugador.nombres }}</p>
            </div>
            <div class="check-icon" *ngIf="isJugadorSeleccionado(jugador)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
              </svg>
            </div>
          </div>
        </div>

        <div class="quinteto-actions">
          <button class="btn btn-lg btn-primary"
                  *ngIf="equipoSeleccionando === 'LOCAL'"
                  [disabled]="quintetoTemporal.length !== 5"
                  (click)="confirmarQuintetoLocal()">
            Confirmar Quinteto Local
          </button>
          
          <button class="btn btn-lg btn-primary"
                  *ngIf="equipoSeleccionando === 'VISITANTE'"
                  [disabled]="quintetoTemporal.length !== 5"
                  (click)="confirmarQuintetoVisitante()">
            Confirmar Quinteto Visitante e Iniciar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- TABLERO EN VIVO -->
  <div class="live-board" *ngIf="!seleccionandoQuinteto && !loading && partido">
    
    <!-- Header Superior -->
    <div class="match-header">
      <button class="btn-back-icon" (click)="goBack()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
      </button>
      
      <div class="match-title">
        <h2>
          <span class="team-name">{{ partido.equipo_local.nombre }}</span>
          <span class="vs">VS</span>
          <span class="team-name">{{ partido.equipo_visitante.nombre }}</span>
        </h2>
      </div>

      <div class="match-actions">
        <button class="btn-icon-header" title="Guardar">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
          </svg>
        </button>
        <button class="btn-icon-header" title="Brillo">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Layout Principal: 3 Columnas -->
    <div class="main-board">
      
      <!-- ========================================
           PANEL IZQUIERDO: EQUIPO LOCAL
           ======================================== -->
      <div class="team-panel team-local">
        <div class="team-panel-header">
          <h3>{{ partido.equipo_local.nombre }}</h3>
          
          <!-- Faltas del Equipo con Indicador de Bonus -->
          <div class="team-fouls-container">
            <div class="team-fouls-label">Faltas del Cuarto</div>
            <div class="team-fouls-value">{{ faltasCuartoLocal }}</div>
            <div class="bonus-indicator" *ngIf="faltasCuartoLocal >= 5">
              üö© BONUS
            </div>
          </div>

          <!-- Timeouts seg√∫n FIBA -->
          <div class="timeouts-fiba-container">
            <div class="timeouts-label">Tiempos Muertos</div>
            <div class="timeouts-disponibles">{{ getTimeoutsDisponibles('LOCAL') }} disponibles</div>
            <div class="timeouts-dots">
              <div class="timeout-dot" 
                   [class.active]="i < partido.equipo_local.timeouts" 
                   *ngFor="let i of [0,1,2,3,4]"
                   (click)="usarTimeout('LOCAL')"></div>
            </div>
          </div>
        </div>

        <!-- Botones de Acciones -->
        <div class="team-actions-buttons">
          <button class="btn-team-action btn-add-points" (click)="abrirModalPuntos('LOCAL')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            Agregar Puntos
          </button>
          <button class="btn-team-action btn-edit-points" (click)="abrirModalEditarPuntos('LOCAL')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
            Editar Puntos
          </button>
        </div>

        <!-- Lista de Jugadores -->
        <div class="jugadores-list">
          <div class="jugador-item"
               *ngFor="let jugador of partido.equipo_local.quinteto"
               [class.encancha]="jugador.enCancha"
               [class.expulsado]="jugador.faltas >= 5">
            
            <!-- N√∫mero -->
            <div class="jugador-numero-mini">{{ jugador.dorsal }}</div>
            
            <!-- Nombre Completo -->
            <div class="jugador-nombre-completo">
              <div class="apellidos">{{ jugador.ap_p }} {{ jugador.ap_m }}</div>
              <div class="nombres">{{ jugador.nombres }}</div>
            </div>
            
            <!-- Faltas (5 c√≠rculos) -->
            <div class="jugador-faltas-mini" (click)="abrirModalFaltas('LOCAL', jugador)">
              <div class="falta-dot" 
                   [class.active]="i < jugador.faltas"
                   [class.expulsion]="i === 4 && jugador.faltas >= 5"
                   *ngFor="let i of [0,1,2,3,4]"></div>
            </div>
            
            <!-- Puntos -->
            <div class="jugador-puntos-mini">{{ jugador.puntos }}</div>
          </div>
        </div>

        <!-- Bot√≥n de Cambio -->
        <button class="btn-cambio" (click)="abrirModalCambio('LOCAL')">
          üîÑ Cambio
        </button>
      </div>

      <!-- ========================================
           PANEL CENTRAL: MARCADOR Y TIMER
           ======================================== -->
      <div class="center-panel">
        
        <!-- Marcador Principal -->
        <div class="scoreboard-main">
          <!-- Score Local -->
          <div class="score-section">
            <div class="score-value">{{ partido.equipo_local.puntos }}</div>
          </div>

          <!-- Divisor Central con Per√≠odo -->
          <div class="center-divider">
            <!-- Per√≠odo -->
            <div class="periodo-section">
              <div class="periodo-label">Per√≠odo</div>
              <div class="periodo-value">{{ partido.periodo_actual }}</div>
            </div>
          </div>

          <!-- Score Visitante -->
          <div class="score-section">
            <div class="score-value">{{ partido.equipo_visitante.puntos }}</div>
          </div>
        </div>

        <!-- Temporizador -->
        <div class="timer-section">
          <div class="timer-label">Temporizador</div>
          <div class="timer-display" (click)="abrirModalEditarTiempo()">
            {{ formatearTiempo(tiempoTranscurrido) }}
          </div>
        </div>

        <!-- Controles del Timer -->
        <div class="timer-controls">
          <button class="btn-timer" (click)="restarTiempo()" title="Restar 1 minuto">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13H5v-2h14v2z"/>
            </svg>
          </button>
          
          <button class="btn-timer btn-stop" (click)="stopTimer()" title="Detener">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
              <rect x="6" y="6" width="12" height="12"/>
            </svg>
          </button>
          
          <button class="btn-timer btn-pause" *ngIf="timerActivo" (click)="pauseTimer()" title="Pausar">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          
          <button class="btn-timer btn-play" *ngIf="!timerActivo" (click)="startTimer()" title="Iniciar">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
          
          <button class="btn-timer" (click)="agregarTiempo()" title="Agregar 1 minuto">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
          </button>
        </div>

        <!-- Acciones R√°pidas -->
        <div class="quick-actions">
          <button class="btn-action" (click)="siguientePeriodo()">
            ‚è≠Ô∏è Siguiente Per√≠odo
          </button>
          <button class="btn-action btn-danger" (click)="finalizarPartido()">
            üèÅ Finalizar Partido
          </button>
        </div>
      </div>

      <!-- ========================================
           PANEL DERECHO: EQUIPO VISITANTE
           ======================================== -->
      <div class="team-panel team-visitante">
        <div class="team-panel-header">
          <h3>{{ partido.equipo_visitante.nombre }}</h3>
          
          <!-- Faltas del Equipo con Indicador de Bonus -->
          <div class="team-fouls-container">
            <div class="team-fouls-label">Faltas del Cuarto</div>
            <div class="team-fouls-value">{{ faltasCuartoVisitante }}</div>
            <div class="bonus-indicator" *ngIf="faltasCuartoVisitante >= 5">
              üö© BONUS
            </div>
          </div>

          <!-- Timeouts seg√∫n FIBA -->
          <div class="timeouts-fiba-container">
            <div class="timeouts-label">Tiempos Muertos</div>
            <div class="timeouts-disponibles">{{ getTimeoutsDisponibles('VISITANTE') }} disponibles</div>
            <div class="timeouts-dots">
              <div class="timeout-dot" 
                   [class.active]="i < partido.equipo_visitante.timeouts" 
                   *ngFor="let i of [0,1,2,3,4]"
                   (click)="usarTimeout('VISITANTE')"></div>
            </div>
          </div>
        </div>

        <!-- Botones de Acciones -->
        <div class="team-actions-buttons">
          <button class="btn-team-action btn-add-points" (click)="abrirModalPuntos('VISITANTE')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            Agregar Puntos
          </button>
          <button class="btn-team-action btn-edit-points" (click)="abrirModalEditarPuntos('VISITANTE')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
            Editar Puntos
          </button>
        </div>

        <!-- Lista de Jugadores -->
        <div class="jugadores-list">
          <div class="jugador-item"
               *ngFor="let jugador of partido.equipo_visitante.quinteto"
               [class.encancha]="jugador.enCancha"
               [class.expulsado]="jugador.faltas >= 5">
            
            <!-- Puntos -->
            <div class="jugador-puntos-mini">{{ jugador.puntos }}</div>
            
            <!-- Faltas (5 c√≠rculos) -->
            <div class="jugador-faltas-mini" (click)="abrirModalFaltas('VISITANTE', jugador)">
              <div class="falta-dot" 
                   [class.active]="i < jugador.faltas"
                   [class.expulsion]="i === 4 && jugador.faltas >= 5"
                   *ngFor="let i of [0,1,2,3,4]"></div>
            </div>
            
            <!-- Nombre Completo -->
            <div class="jugador-nombre-completo">
              <div class="apellidos">{{ jugador.ap_p }} {{ jugador.ap_m }}</div>
              <div class="nombres">{{ jugador.nombres }}</div>
            </div>
            
            <!-- N√∫mero -->
            <div class="jugador-numero-mini">{{ jugador.dorsal }}</div>
          </div>
        </div>

        <!-- Bot√≥n de Cambio -->
        <button class="btn-cambio" (click)="abrirModalCambio('VISITANTE')">
          üîÑ Cambio
        </button>
      </div>

    </div>
  </div>
</div>

<!-- ========================================
     MODALES
     ======================================== -->

<!-- MODAL DE AGREGAR PUNTOS -->
<div class="modal-overlay" *ngIf="modalPuntosAbierto" (click)="cerrarModalPuntos()">
  <div class="modal-content-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚ûï Agregar Puntos</h2>
      <button class="btn-close" (click)="cerrarModalPuntos()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Selecci√≥n de Jugador -->
      <div class="puntos-jugador-section">
        <h3>Selecciona el jugador:</h3>
        <div class="jugadores-puntos-grid">
          <div class="jugador-punto-card"
               *ngFor="let jugador of equipoPuntos === 'LOCAL' ? (partido?.equipo_local?.quinteto || []) : (partido?.equipo_visitante?.quinteto || [])"
               [class.selected]="jugadorPuntos?.id_jugador === jugador.id_jugador"
               (click)="seleccionarJugadorPuntos(jugador)">
            <div class="jugador-numero-punto">{{ jugador.dorsal }}</div>
            <div class="jugador-nombre-punto">
              <div class="apellidos-punto">{{ jugador.ap_p }} {{ jugador.ap_m }}</div>
              <div class="nombres-punto">{{ jugador.nombres }}</div>
            </div>
            <div class="jugador-stats-punto">{{ jugador.puntos }} pts</div>
          </div>
        </div>
      </div>

      <!-- Selecci√≥n de Valor -->
      <div class="puntos-valor-section" *ngIf="jugadorPuntos">
        <h3>Selecciona el valor:</h3>
        <div class="puntos-opciones">
          <button class="btn-punto-valor" 
                  [class.selected]="puntosPorAgregar === 1"
                  (click)="seleccionarPuntos(1)">
            <span class="valor">+1</span>
            <small>Tiro Libre</small>
          </button>
          <button class="btn-punto-valor" 
                  [class.selected]="puntosPorAgregar === 2"
                  (click)="seleccionarPuntos(2)">
            <span class="valor">+2</span>
            <small>Canasta</small>
          </button>
          <button class="btn-punto-valor" 
                  [class.selected]="puntosPorAgregar === 3"
                  (click)="seleccionarPuntos(3)">
            <span class="valor">+3</span>
            <small>Triple</small>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalPuntos()">Cancelar</button>
      <button class="btn btn-primary" 
              [disabled]="!jugadorPuntos || puntosPorAgregar === 0"
              (click)="confirmarAgregarPuntos()">
        Confirmar
      </button>
    </div>
  </div>
</div>

<!-- MODAL DE EDITAR PUNTOS (RESTAR) -->
<div class="modal-overlay" *ngIf="modalEditarPuntosAbierto" (click)="cerrarModalEditarPuntos()">
  <div class="modal-content-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚úèÔ∏è Editar Puntos</h2>
      <button class="btn-close" (click)="cerrarModalEditarPuntos()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Selecci√≥n de Jugador -->
      <div class="puntos-jugador-section">
        <h3>Selecciona el jugador:</h3>
        <div class="jugadores-puntos-grid">
          <div class="jugador-punto-card"
               *ngFor="let jugador of equipoEditarPuntos === 'LOCAL' ? (partido?.equipo_local?.quinteto || []) : (partido?.equipo_visitante?.quinteto || [])"
               [class.selected]="jugadorEditarPuntos?.id_jugador === jugador.id_jugador"
               (click)="seleccionarJugadorEditarPuntos(jugador)">
            <div class="jugador-numero-punto">{{ jugador.dorsal }}</div>
            <div class="jugador-nombre-punto">
              <div class="apellidos-punto">{{ jugador.ap_p }} {{ jugador.ap_m }}</div>
              <div class="nombres-punto">{{ jugador.nombres }}</div>
            </div>
            <div class="jugador-stats-punto">{{ jugador.puntos }} pts</div>
          </div>
        </div>
      </div>

      <!-- Selecci√≥n de Valor -->
      <div class="puntos-valor-section" *ngIf="jugadorEditarPuntos">
        <h3>Selecciona el valor a restar:</h3>
        <div class="puntos-opciones">
          <button class="btn-punto-valor btn-restar" 
                  [class.selected]="puntosPorRestar === 1"
                  (click)="seleccionarPuntosRestar(1)">
            <span class="valor">-1</span>
            <small>Tiro Libre</small>
          </button>
          <button class="btn-punto-valor btn-restar" 
                  [class.selected]="puntosPorRestar === 2"
                  (click)="seleccionarPuntosRestar(2)">
            <span class="valor">-2</span>
            <small>Canasta</small>
          </button>
          <button class="btn-punto-valor btn-restar" 
                  [class.selected]="puntosPorRestar === 3"
                  (click)="seleccionarPuntosRestar(3)">
            <span class="valor">-3</span>
            <small>Triple</small>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalEditarPuntos()">Cancelar</button>
      <button class="btn btn-warning" 
              [disabled]="!jugadorEditarPuntos || puntosPorRestar === 0"
              (click)="confirmarEditarPuntos()">
        Restar Puntos
      </button>
    </div>
  </div>
</div>

<!-- MODAL DE FALTAS -->
<div class="modal-overlay" *ngIf="modalFaltasAbierto" (click)="cerrarModalFaltas()">
  <div class="modal-content-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚ö†Ô∏è Registrar Falta</h2>
      <button class="btn-close" (click)="cerrarModalFaltas()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="jugador-puntos-info" *ngIf="jugadorFaltas">
        <div class="jugador-numero-grande">{{ jugadorFaltas.dorsal }}</div>
        <h3>{{ jugadorFaltas.ap_p }} {{ jugadorFaltas.ap_m }}</h3>
        <p class="nombre-pila">{{ jugadorFaltas.nombres }}</p>
        <p class="faltas-actuales">Faltas actuales: {{ jugadorFaltas.faltas }}/5</p>
      </div>

      <p style="text-align: center; margin: 20px 0; color: #ddd;">
        ¬øConfirmar falta personal?
        <span *ngIf="jugadorFaltas && jugadorFaltas.faltas === 4" style="display: block; color: #ff3333; font-weight: 700; margin-top: 10px;">
          ‚ö†Ô∏è Esta ser√° su QUINTA falta - Ser√° EXPULSADO
        </span>
      </p>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModalFaltas()">Cancelar</button>
        <button class="btn btn-warning" (click)="registrarFalta()">Confirmar Falta</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL DE SUSTITUCI√ìN FORZADA -->
<div class="modal-overlay" *ngIf="modalSustitucionForzadaAbierto" (click)="$event.stopPropagation()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üî¥ Sustituci√≥n Obligatoria</h2>
    </div>

    <div class="modal-body">
      <div class="expulsion-notice">
        <h3>Jugador Expulsado por 5 Faltas</h3>
        <div class="jugador-expulsado-info" *ngIf="jugadorExpulsado">
          <div class="jugador-numero-grande">{{ jugadorExpulsado.dorsal }}</div>
          <h4>{{ jugadorExpulsado.ap_p }} {{ jugadorExpulsado.ap_m }}</h4>
          <p>{{ jugadorExpulsado.nombres }}</p>
        </div>
      </div>

      <div class="cambio-section">
        <h3>Selecciona un jugador sustituto:</h3>
        <div class="jugadores-cambio">
          <div class="jugador-cambio-card"
               *ngFor="let jugador of jugadoresSustitutos"
               [class.selected]="jugadorSustituto?.id_jugador === jugador.id_jugador"
               [class.disabled]="jugador.faltas >= 5"
               (click)="jugador.faltas < 5 && seleccionarJugadorSustituto(jugador)">
            <div class="jugador-numero-cambio">{{ jugador.dorsal }}</div>
            <div class="jugador-nombre-cambio">
              <div class="apellidos-cambio">{{ jugador.ap_p }} {{ jugador.ap_m }}</div>
              <div class="nombres-cambio">{{ jugador.nombres }}</div>
              <span *ngIf="jugador.faltas >= 5" class="expulsado-label">EXPULSADO</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-primary" 
              [disabled]="!jugadorSustituto"
              (click)="confirmarSustitucionForzada()">
        Confirmar Sustituci√≥n
      </button>
    </div>
  </div>
</div>

<!-- MODAL DE CAMBIO -->
<div class="modal-overlay" *ngIf="modalCambioAbierto" (click)="cerrarModalCambio()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üîÑ Realizar Cambio</h2>
      <button class="btn-close" (click)="cerrarModalCambio()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="cambio-section">
        <h3>Sale de la cancha:</h3>
        <div class="jugadores-cambio">
          <div class="jugador-cambio-card"
               *ngFor="let jugador of equipoCambio === 'LOCAL' ? (partido?.equipo_local?.quinteto || []) : (partido?.equipo_visitante?.quinteto || [])"
               [class.selected]="jugadorSaliente?.id_jugador === jugador.id_jugador"
               (click)="seleccionarJugadorSaliente(jugador)">
            <div class="jugador-numero-cambio">{{ jugador.dorsal }}</div>
            <div class="jugador-nombre-cambio">
              <div class="apellidos-cambio">{{ jugador.ap_p }} {{ jugador.ap_m }}</div>
              <div class="nombres-cambio">{{ jugador.nombres }}</div>
            </div>
          </div>
        </div>
      </div>

      <div class="cambio-arrow">‚Üì</div>

      <div class="cambio-section">
        <h3>Entra a la cancha:</h3>
        <div class="jugadores-cambio">
          <div class="jugador-cambio-card"
               *ngFor="let jugador of equipoCambio === 'LOCAL' ? (partido?.equipo_local?.banco || []) : (partido?.equipo_visitante?.banco || [])"
               [class.selected]="jugadorEntrante?.id_jugador === jugador.id_jugador"
               [class.disabled]="jugador.faltas >= 5"
               (click)="jugador.faltas < 5 && seleccionarJugadorEntrante(jugador)">
            <div class="jugador-numero-cambio">{{ jugador.dorsal }}</div>
            <div class="jugador-nombre-cambio">
              <div class="apellidos-cambio">{{ jugador.ap_p }} {{ jugador.ap_m }}</div>
              <div class="nombres-cambio">{{ jugador.nombres }}</div>
              <span *ngIf="jugador.faltas >= 5" class="expulsado-label">EXPULSADO</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalCambio()">Cancelar</button>
      <button class="btn btn-primary" 
              [disabled]="!jugadorSaliente || !jugadorEntrante"
              (click)="confirmarCambio()">
        Confirmar Cambio
      </button>
    </div>
  </div>
</div>

<!-- MODAL EDITAR TIEMPO -->
<div class="modal-overlay" *ngIf="modalEditarTiempoAbierto" (click)="cerrarModalEditarTiempo()">
  <div class="modal-content-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚è±Ô∏è Editar Tiempo</h2>
      <button class="btn-close" (click)="cerrarModalEditarTiempo()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="editar-tiempo-form">
        <div class="tiempo-input-group">
          <label>Minutos</label>
          <input type="number" 
                 [(ngModel)]="minutosEditar" 
                 min="0" 
                 max="99"
                 class="tiempo-input">
        </div>
        
        <div class="tiempo-separator">:</div>
        
        <div class="tiempo-input-group">
          <label>Segundos</label>
          <input type="number" 
                 [(ngModel)]="segundosEditar" 
                 min="0" 
                 max="59"
                 class="tiempo-input">
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalEditarTiempo()">Cancelar</button>
      <button class="btn btn-primary" (click)="confirmarEditarTiempo()">Confirmar</button>
    </div>
  </div>
</div>