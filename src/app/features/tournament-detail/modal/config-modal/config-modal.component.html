<app-modal-base
  [isOpen]="isOpen"
  title="Configuraci√≥n del Torneo"
  size="large"
  (closeModal)="close()"
>
  <form (ngSubmit)="save()">
    <div class="modal-body">
      
      <!-- ‚úÖ ALERTA SI TORNEO EST√Å BLOQUEADO -->
      <div *ngIf="isLocked()" class="alert alert-warning" style="margin-bottom: 20px;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        ‚ö†Ô∏è Este torneo ya fue iniciado. No se puede editar la configuraci√≥n.
      </div>

      <!-- ‚úÖ ALERTA SI HAY CAMBIOS Y YA EXISTE CALENDARIO -->
      <div *ngIf="!isLocked() && hasCalendar && configChanged" class="alert alert-info" style="margin-bottom: 20px; background: #e3f2fd; border-color: #2196f3; color: #1565c0;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        üí° Has modificado par√°metros que afectan el calendario. Deber√°s regenerarlo despu√©s de guardar.
      </div>

      <div class="form-section">
        <div class="form-group">
          <label>Nombre del torneo *</label>
          <input
            type="text"
            [(ngModel)]="editForm.nombre"
            name="nombre"
            placeholder="Ej: Liga Primavera 2025"
            [disabled]="isLocked()"
          />
        </div>

        <div class="form-grid">
          <div class="form-counter">
            <label>Vueltas a jugar</label>
            <div class="counter">
              <button 
                type="button" 
                (click)="decrementar('vueltas')"
                [disabled]="isLocked()"
              >‚àí</button>
              <span>{{ editForm.vueltas }}</span>
              <button 
                type="button" 
                (click)="incrementar('vueltas')"
                [disabled]="isLocked()"
              >+</button>
            </div>
          </div>

          <div class="form-counter">
            <label>Clasificaci√≥n de playoffs</label>
            <div class="counter">
              <button 
                type="button" 
                (click)="decrementar('cupos_playoffs')"
                [disabled]="isLocked()"
              >‚àí</button>
              <span>{{ editForm.cupos_playoffs }}</span>
              <button 
                type="button" 
                (click)="incrementar('cupos_playoffs')"
                [disabled]="isLocked()"
              >+</button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Modalidad de juego</label>
          <div class="mode-buttons">
            <input type="text" [readonly]="true" value="3 vs 3" class="mode-input" />
            <button
              type="button"
              class="mode-btn"
              [class.active]="editForm.modalidad === '5v5'"
              (click)="!isLocked() && (editForm.modalidad = '5v5')"
              [disabled]="isLocked()"
            >
              5 vs 5
            </button>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-counter">
            <label>D√≠as por semana</label>
            <div class="counter">
              <button 
                type="button" 
                (click)="decrementar('dias_por_semana')"
                [disabled]="isLocked()"
              >‚àí</button>
              <span>{{ editForm.dias_por_semana }}</span>
              <button 
                type="button" 
                (click)="incrementar('dias_por_semana')"
                [disabled]="isLocked()"
              >+</button>
            </div>
          </div>

          <div class="form-counter">
            <label>Partidos por d√≠a</label>
            <div class="counter">
              <button 
                type="button" 
                (click)="decrementar('partidos_por_dia')"
                [disabled]="isLocked()"
              >‚àí</button>
              <span>{{ editForm.partidos_por_dia }}</span>
              <button 
                type="button" 
                (click)="incrementar('partidos_por_dia')"
                [disabled]="isLocked()"
              >+</button>
            </div>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Hora de inicio</label>
            <input
              type="time"
              [(ngModel)]="editForm.hora_ini"
              name="hora_ini"
              (change)="checkConfigChanges()"
              [disabled]="isLocked()"
              required
            />
          </div>

          <div class="form-group">
            <label>Hora de fin</label>
            <input
              type="time"
              [(ngModel)]="editForm.hora_fin"
              name="hora_fin"
              (change)="checkConfigChanges()"
              [disabled]="isLocked()"
              required
            />
          </div>
        </div>

        <div class="form-counter">
          <label>Duraci√≥n de partido (minutos)</label>
          <div class="counter">
            <button
              type="button"
              (click)="editForm.slot_min = Math.max(10, (editForm.slot_min ?? 0) - 10); checkConfigChanges()"
              [disabled]="isLocked()"
            >
              ‚àí
            </button>
            <span>{{ editForm.slot_min ?? 0 }} min</span>
            <button
              type="button"
              (click)="editForm.slot_min = (editForm.slot_min ?? 0) + 10; checkConfigChanges()"
              [disabled]="isLocked()"
            >
              +
            </button>
          </div>
        </div>
      </div>

      <hr />

      <div class="form-section">
        <h4 class="section-title">
          <span class="icon">üèüÔ∏è</span> Canchas del Torneo
        </h4>

        <div *ngIf="canchas.length === 0" class="empty-state">
          <p>No hay canchas agregadas</p>
        </div>

        <ul *ngIf="canchas.length > 0" class="cancha-list">
          <li *ngFor="let cancha of canchas" class="cancha-item">
            <div>
              <strong>{{ cancha.nombre }}</strong>
              <span class="cancha-ubicacion">{{ cancha.ubicacion }}</span>
            </div>
            <button 
              type="button"
              class="btn-icon-small btn-delete" 
              (click)="eliminarCancha(cancha)"
              [disabled]="isLocked()"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </li>
        </ul>

        <div class="form-grid cancha-form" *ngIf="!isLocked()">
          <input
            type="text"
            placeholder="Nombre de la cancha"
            [(ngModel)]="nuevaCancha.nombre"
            name="nombre_cancha"
          />
          <input
            type="text"
            placeholder="Ubicaci√≥n"
            [(ngModel)]="nuevaCancha.ubicacion"
            name="ubicacion"
          />
          <button
            type="button"
            class="btn btn-primary"
            (click)="agregarCancha()"
          >
            + Agregar
          </button>
        </div>
      </div>

      <!-- ‚úÖ SECCI√ìN REGENERAR CALENDARIO -->
      <div *ngIf="!isLocked() && hasCalendar" class="form-section">
        <hr />
        <h4 class="section-title">
          <span class="icon">üîÑ</span> Regenerar Calendario
        </h4>
        
        <div class="alert alert-info" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
          <p style="margin: 0 0 10px 0;">
            <strong>‚ö†Ô∏è Cuidado:</strong> Regenerar el calendario borrar√° todos los partidos actuales y crear√° nuevos.
          </p>
          <button
            type="button"
            class="btn btn-warning"
            (click)="regenerarCalendario()"
            style="background: #ffc107; color: #000; border: none;"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 5px;">
              <path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"/>
            </svg>
            Regenerar Calendario
          </button>
        </div>
      </div>
    </div>

    <div slot="footer" class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="close()">
        {{ isLocked() ? 'Cerrar' : 'Cancelar' }}
      </button>
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="isLocked()"
        *ngIf="!isLocked()"
      >
        Guardar Configuraci√≥n
      </button>
    </div>
  </form>
</app-modal-base>